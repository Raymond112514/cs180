---
layout: post
---

## Face morphing

### Overview

The goal of this project is to morph two faces to create a new one. A naive approach is to directly average the two faces, as shown in Figure 1. However, this method generally does not work well because the two images are often not aligned. To morph two images, we need to follow two steps: alignment and color blending. We will walk through each of these steps in detail in this project.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/naive_align.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 1:</strong> Blended image by taking direct average. Note that the faces are not aligned.</p>

### Morphing two faces

#### Defining correspondence

To align the two images, we start by labeling key points on both images. These points will serve as landmarks for the morphing process. Next, we apply Delaunay triangulation using the `scipy.spatial.Delaunay` library. We use the average key points to compute the triangulation, making it less dependent on the individual images. In the next section, we will map the pixel intensity values from the midway triangle to the corresponding original triangles to perform warping (Figure 2).

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/example.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 2:</strong> Illustration of the process: We map the triangle formed by the midway key points (b) to the corresponding triangle in the original image (a). The pixel intensity values are interpolated.</p>

The key points for the two images and the triangulation of the midway image are shown below.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/triangles.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 3:</strong> Triangulation of the original images (a), (b), and the midway image (c).</p>

#### Computing midway face

As an initial example, we first compute the midway face of the two images. To do this, we begin by warping the images to align them. After warping, we then average the pixel values to blend the colors, resulting in the midway face.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/midway.png" alt="Image 1" style="width: 95%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 4:</strong> Midway face after alignment.</p>

#### The morph sequence

We can now apply the same methods to compute the morphed image by varying the warp fraction $\alpha$ and the dissolve fraction $\beta$. The following animation is generated by changing $\alpha$ and $\beta$ in regular intervals of $0.43$ within the range $[0,1]$.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/isaac_vincent_warped_dissolved.gif" alt="Image 1" style="width: 40%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 5:</strong> Morphed image with varying warp and dissolve fraction.</p>

### The mean face of a population

We now move on to morphing images to the mean face of a population. To compute the mean face, we used the IMM face dataset, which consists of 240 images of faces from different individuals. We calculate the mean face by first averaging the keypoints from all images, then warping each image to the mean geometry. Some examples are shown below.



We then average the faces across all individuals. Before computing the mean face, we filter out all faces that are not front views. This process gives us the mean face, as shown in Figure 7. Since there are more males (128) than females (29) in the database, the resulting mean face resembles that of a male. To obtain a female mean face, we also restrict the set to include only female images.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/mean_face.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 7:</strong> "Mean" face in the IMM face database. (a) All faces, (b) Restricted to female faces.</p>

We can also warp images of our choice to the average geometry, as well as warp the average geometry to the images.

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/two_way_warp.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 8:</strong> (a) Isaac warped to mean face, (b) The other way around.</p>

#### Extrapolating from the mean

We can create a caricature from the mean by increasing the warp fraction $\alpha$ outside the range $[0,1]$. Below shows examples of warped Isaac with $\alpha=-0.1$ and $\alpha=2$, respectively. 

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/caricature.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 9:</strong> Isaacs with different features enhanced through varying $\alpha$.</p>

### Ethinicity change

We can use the mean image from a particular ethnic group to change the ethnicity of another face. For example, consider the mean face of Africans. After morphing the faces, we obtain the following results:

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj3_images/ethnic.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 10:</strong> The shape (a), appearance (b), and morphed image (c).</p>



