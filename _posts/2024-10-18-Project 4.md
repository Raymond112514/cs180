---
layout: post
---

## Image Warping and Mosaicing

### Image Labeling

The goal of this project is take two images in different angles and create an image mosaic by aligning, warping, and compositing them. We first take images of our choices and uses online labeling tool to label eight correspondence points. We will be using these points to estimate a homography map for registration later. 

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj4_images/source_target.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 1:</strong> Labeled source and target images.</p>

### Homography Estimation and Warping

Given a list of source points $\mathcal{S}= \{(x_i, y_i)\}$ and target points $\mathcal{T}=\{(\tilde{x}_i, \tilde{y}_i)\}$, to estimate a homography matrix $\mathbf{H}$, note that each source-target pair imposes the constraint

$$\begin{bmatrix}
a & b & c\\
d & e & f\\
g & h & 1
\end{bmatrix}\begin{bmatrix}
x_i\\
y_i\\
1
\end{bmatrix}=\begin{bmatrix}
\xi \tilde{x}_i\\
\xi \tilde{y}_i\\
\xi
\end{bmatrix}$$

Simplifying gives us 

$$
\begin{bmatrix}
x_i & y_i & 1 & 0 & 0 & 0 & -x_i\tilde{x}_i & -y_i\tilde{x}_i\\
0 & 0 & 0 & x_i & y_i & 1 & -x_i\tilde{y}_i & -y_i\tilde{x}_i\\
\end{bmatrix}
\begin{bmatrix}
a\\
b\\
c\\
d\\
e\\
f\\
g\\
h\\
\end{bmatrix}
=\begin{bmatrix}
\tilde{x}_i\\
\tilde{y}_i
\end{bmatrix}$$

Since there are $8$ variables, $4$ correspondence points are needed to estimate a unique homography transformation. However, one can also choose more than $4$ points and then solve the system using least squares. In our case, we choose $8$ correspondence points for each image and estimated the homography transformation using the `np.lstsq` function. After estimating the homography matrix, we can then apply inverse warp as in the previous project. 

### Aside: Image Rectification

### Image Mosaic

We warped the target images with the estimated homography transformation, this gives us the following. Note that the images are now aligned. 

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj4_images/warp.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 3:</strong> Warped and aligned source/target images.</p>

We now blend the image using the Laplacian pyramid approach with vertical binary masks. Below shows the final results of the image mosaic. 

<div style="display: flex; justify-content: center;">   
   <img src="{{ site.baseurl }}/assets/proj4_images/mosaic.png" alt="Image 1" style="width: 90%; height: auto;"> 
</div> 
<p style="text-align: center; margin-top: 15px;"><strong>Figure 4:</strong> Mosaic images.</p>








